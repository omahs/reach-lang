[{"bookPath":"","title":"ERC20","titleId":"erc20","hasOtp":true,"hasPageHeader":true},"<h1 id=\"erc20\" class=\"refHeader\">ERC20<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#erc20\"><span class=\"icon icon-link\"></span></a></h1>\n<p><i id=\"p_0\" class=\"pid\"></i>This tutorial will demonstrate the <a href=\"https://eips.ethereum.org/EIPS/eip-20\" target=\"_blank\">ERC20 spec</a> in <a href=\"https://docs.reach.sh/#reach-top\" target=\"_blank\">Reach</a>.<a href=\"#p_0\" class=\"pid\">0</a></p>\n<p>\n  <i id=\"p_1\" class=\"pid\"></i>It assumes prior knowledge of Reach: we recommend completing the\n  <a href=\"https://docs.reach.sh/tut/rps/\" target=\"_blank\">Rock, Paper, Scissors</a> tutorial and the <a href=\"https://docs.reach.sh/tut/rsvp/\" target=\"_blank\">RSVP</a> tutorial first.<a href=\"#p_1\" class=\"pid\">1</a>\n</p>\n<p><i id=\"p_2\" class=\"pid\"></i>We assume you are working in a project folder called <code>erc20</code>:<a href=\"#p_2\" class=\"pid\">2</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"mkdir erc20\n$ cd erc20\" href=\"#\" id=\"copyBtn1\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-keyword)\">$</span><span style=\"color: var(--shiki-color-text)\"> mkdir erc20</span></li><li value=\"2\"><span style=\"color: var(--shiki-token-keyword)\">$</span><span style=\"color: var(--shiki-color-text)\"> cd erc20</span></li></ol></pre>\n<p><i id=\"p_3\" class=\"pid\"></i>Start by creating your files:<a href=\"#p_3\" class=\"pid\">3</a></p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"touch index.rsh index.mjs\" href=\"#\" id=\"copyBtn2\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-keyword)\">$</span><span style=\"color: var(--shiki-color-text)\"> touch index.rsh index.mjs</span></li></ol></pre>\n<h2 id=\"the-erc20-standard\" class=\"refHeader\">The ERC20 Standard<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-erc20-standard\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_4\" class=\"pid\"></i>Our application is going to implement the <a href=\"https://eips.ethereum.org/EIPS/eip-20\" target=\"_blank\">ERC20 token spec</a> and allow these functions to be called indefinitely.\n  We'll implement the standard ERC20 functions, views and events.<a href=\"#p_4\" class=\"pid\">4</a>\n</p>\n<p><i id=\"p_5\" class=\"pid\"></i>The functions are:<a href=\"#p_5\" class=\"pid\">5</a></p>\n<ul>\n  <li><code>name(): string</code></li>\n  <li><code>symbol(): string</code></li>\n  <li><code>decimals(): uint8</code></li>\n  <li><code>totalSupply(): uint256</code></li>\n  <li><code>balanceOf(account: address): uint256</code></li>\n  <li><code>transfer(to: address, amount: uint256): bool</code></li>\n  <li><code>allowance(owner: address, spender: address): uint256</code></li>\n  <li><code>approve(spender: address, amount: uint256): bool</code></li>\n  <li><code>transferFrom(from: address, to: address, amount: uint256): bool</code></li>\n</ul>\n<p><i id=\"p_6\" class=\"pid\"></i>And the events are:<a href=\"#p_6\" class=\"pid\">6</a></p>\n<ul>\n  <li><i id=\"p_7\" class=\"pid\"></i><code>Transfer(from: address, to: address, value: uint256)</code> which <em>MUST</em> trigger when tokens are transferred, including zero value transfers.<a href=\"#p_7\" class=\"pid\">7</a></li>\n  <li><i id=\"p_8\" class=\"pid\"></i><code>Approval(owner: address, spender: address, value: uint256)</code> which <em>MUST</em> trigger on any successful call to <code>approve(spender, amount)</code>.<a href=\"#p_8\" class=\"pid\">8</a></li>\n</ul>\n<h2 id=\"the-erc20-standard-in-reach\" class=\"refHeader\">The ERC20 Standard in Reach<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-erc20-standard-in-reach\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_9\" class=\"pid\"></i>We can encode all of this in Reach in the following way:<a href=\"#p_9\" class=\"pid\">9</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const D = Participant('Deployer', {\n    meta: Object({\n      name: StringDyn,\n      symbol: StringDyn,\n      decimals: UInt,\n      totalSupply: UInt,\n      zeroAddress: Address,\n    }),\n    launched: Fun([Contract], Null),\n  });\n  const A = API({\n    transfer: Fun([Address, UInt], Bool),\n    transferFrom: Fun([Address, Address, UInt], Bool),\n    approve: Fun([Address, UInt], Bool),\n  });\n  const V = View({\n    name: Fun([], StringDyn),\n    symbol: Fun([], StringDyn),\n    decimals: Fun([], UInt),\n    totalSupply: Fun([], UInt),\n    balanceOf: Fun([Address], UInt),\n    allowance: Fun([Address, Address], UInt),\n  });\n  const E = Events({\n    Transfer: [Address, Address, UInt],\n    Approval: [Address, Address, UInt],\n  });\" href=\"#\" id=\"copyBtn3\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">D</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Deployer'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">    meta</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Object\" title=\"rsh: Object\"><span style=\"color: var(--shiki-token-constant)\">Object</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">      name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> StringDyn</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">      symbol</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> StringDyn</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">      decimals</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">      totalSupply</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">      zeroAddress</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">    })</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Contract]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-function)\">API</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">    transfer</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    transferFrom</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">    approve</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-token-function)\">View</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">    name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> StringDyn)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">    symbol</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> StringDyn)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    decimals</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">    totalSupply</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">    balanceOf</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">    allowance</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-token-function)\">Events</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">    Transfer</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">    Approval</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<h2 id=\"the-core-of-an-erc20-in-reach\" class=\"refHeader\">The Core of an ERC20 in Reach<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-core-of-an-erc20-in-reach\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_10\" class=\"pid\"></i>The program will first accept the token metadata and parameters and then allow our <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span> member functions to be called indefinitely.\n  This means we'll use the mighty <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> with special considerations.<a href=\"#p_10\" class=\"pid\">10</a>\n</p>\n<p><i id=\"p_11\" class=\"pid\"></i>Let's define our users.<a href=\"#p_11\" class=\"pid\">11</a></p>\n<p>\n  <i id=\"p_12\" class=\"pid\"></i>The application starts with the Deployer providing the token metadata and deploying the contract with the first <span class=\"snip\"><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-color-text)\">publish</span></a></span>.\n  So, we add some token data definitions to our <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-color-text)\">Participant</span></a></span>.<a href=\"#p_12\" class=\"pid\">12</a>\n</p>\n<p><i id=\"p_13\" class=\"pid\"></i>This structure will allow a single address to bind to <code>D</code> and allow <code>A</code> functions to be called by other contracts or off-chain by frontends representing any number of different users.<a href=\"#p_13\" class=\"pid\">13</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"'reach 0.1';\n\nexport const main = Reach.App(() => {\n  setOptions({ connectors: [ETH] });\n  const D = Participant('Deployer', {\n    meta: Object({\n      name: StringDyn,\n      symbol: StringDyn,\n      decimals: UInt,\n      totalSupply: UInt,\n      zeroAddress: Address,\n    }),\n    launched: Fun([Contract], Null),\n  });\n  const A = API({\n    transfer: Fun([Address, UInt], Bool),\n    transferFrom: Fun([Address, Address, UInt], Bool),\n    approve: Fun([Address, UInt], Bool),\n  });\n  const V = View({\n    name: Fun([], StringDyn),\n    symbol: Fun([], StringDyn),\n    decimals: Fun([], UInt),\n    totalSupply: Fun([], UInt),\n    balanceOf: Fun([Address], UInt),\n    allowance: Fun([Address, Address], UInt),\n  });\n  const E = Events({\n    Transfer: [Address, Address, UInt],\n    Approval: [Address, Address, UInt],\n  });\" href=\"#\" id=\"copyBtn4\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-string-expression)\">'reach 0.1'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"></li><li value=\"3\"><a href=\"/rsh/module/#rsh_export\" title=\"rsh: export\"><span style=\"color: var(--shiki-token-keyword)\">export</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">main</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/module/#rsh_Reach\" title=\"rsh: Reach\"><span style=\"color: var(--shiki-token-constant)\">Reach</span></a><a href=\"/rsh/module/#rsh_Reach.App\" title=\"rsh: Reach.App\"><span style=\"color: var(--shiki-token-function)\">.App</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"4\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_setOptions\" title=\"rsh: setOptions\"><span style=\"color: var(--shiki-token-function)\">setOptions</span></a><span style=\"color: var(--shiki-color-text)\">({ connectors</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [</span><a href=\"/rsh/appinit/#rsh_ETH\" title=\"rsh: ETH\"><span style=\"color: var(--shiki-token-constant)\">ETH</span></a><span style=\"color: var(--shiki-color-text)\">] });</span></li><li value=\"5\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">D</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Participant\" title=\"rsh: Participant\"><span style=\"color: var(--shiki-token-function)\">Participant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Deployer'</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">    meta</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Object\" title=\"rsh: Object\"><span style=\"color: var(--shiki-token-constant)\">Object</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">      name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> StringDyn</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">      symbol</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> StringDyn</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"9\"><span style=\"color: var(--shiki-color-text)\">      decimals</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"10\"><span style=\"color: var(--shiki-color-text)\">      totalSupply</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> UInt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"11\"><span style=\"color: var(--shiki-color-text)\">      zeroAddress</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"12\"><span style=\"color: var(--shiki-color-text)\">    })</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"13\"><span style=\"color: var(--shiki-color-text)\">    launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Contract]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Null)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"14\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-function)\">API</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">    transfer</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">    transferFrom</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">    approve</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Bool)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-token-function)\">View</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">    name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> StringDyn)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"22\"><span style=\"color: var(--shiki-color-text)\">    symbol</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> StringDyn)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"23\"><span style=\"color: var(--shiki-color-text)\">    decimals</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">    totalSupply</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">    balanceOf</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">    allowance</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Fun\" title=\"rsh: Fun\"><span style=\"color: var(--shiki-token-function)\">Fun</span></a><span style=\"color: var(--shiki-color-text)\">([Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/appinit/#rsh_Events\" title=\"rsh: Events\"><span style=\"color: var(--shiki-token-function)\">Events</span></a><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">    Transfer</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">    Approval</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> [Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<ul>\n  <li>\n    <i id=\"p_14\" class=\"pid\"></i>Line 6 declares the token metadata as an <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Object\" title=\"rsh: Object\"><span style=\"color: var(--shiki-token-constant)\">Object</span></a></span> with specified fields.\n    (Click on <span class=\"snip\"><a href=\"/rsh/compute/#rsh_StringDyn\" title=\"rsh: StringDyn\"><span style=\"color: var(--shiki-color-text)\">StringDyn</span></a></span> if you've never seen it before!)<a href=\"#p_14\" class=\"pid\">14</a>\n  </li>\n  <li>\n    <i id=\"p_15\" class=\"pid\"></i>Line 13 defines a <code>launched</code> function to notify the frontend of contract deployment.\n    This is a good practice when building this style of Reach DApp. When done correctly, it prevents frontend interaction that relies on a deployed contract before it is complete.<a href=\"#p_15\" class=\"pid\">15</a>\n  </li>\n  <li><i id=\"p_16\" class=\"pid\"></i>Line 15 declares an <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span>.<a href=\"#p_16\" class=\"pid\">16</a></li>\n  <li><i id=\"p_17\" class=\"pid\"></i>Lines 16-18 declare the functions our <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span> members are allowed to call. These are the functions defined by the ERC20 spec.<a href=\"#p_17\" class=\"pid\">17</a></li>\n  <li><i id=\"p_18\" class=\"pid\"></i>Line 20 declares a <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span> that makes the information more easily accessible to the frontend.<a href=\"#p_18\" class=\"pid\">18</a></li>\n  <li><i id=\"p_19\" class=\"pid\"></i>Lines 21-26 sets the information we make available to our <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>.<a href=\"#p_19\" class=\"pid\">19</a></li>\n  <li><i id=\"p_20\" class=\"pid\"></i>Line 28 declares an <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">Event</span></span> that will allow monitoring of our Reach program.<a href=\"#p_20\" class=\"pid\">20</a></li>\n  <li><i id=\"p_21\" class=\"pid\"></i>Line 29-30 declares the two events that we will emit and their values.<a href=\"#p_21\" class=\"pid\">21</a></li>\n</ul>\n<div class=\"note\">\n  <p><i id=\"p_22\" class=\"pid\"></i>The <code>transferFrom</code> method allows contracts to transfer tokens on your behalf and/or to charge fees in sub-currencies. <a href=\"https://eips.ethereum.org/EIPS/eip-20#simple-summary\" target=\"_blank\">Source</a><a href=\"#p_22\" class=\"pid\">22</a></p>\n</div>\n<p><i id=\"p_23\" class=\"pid\"></i>That is all for our data definitions, so we start defining the states of our program.<a href=\"#p_23\" class=\"pid\">23</a></p>\n<p><i id=\"p_24\" class=\"pid\"></i>As noted earlier, the first step is to have the Deployer provide the token metadata and actually deploy the contract with the first publish.<a href=\"#p_24\" class=\"pid\">24</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  init();\n  D.only(() => {\n    const {name, symbol, decimals, totalSupply, zeroAddress} = declassify(interact.meta);\n  });\n  D.publish(name, symbol, decimals, totalSupply, zeroAddress).check(() => {\n    check(decimals < 256, 'decimals fits in UInt8');\n  });\" href=\"#\" id=\"copyBtn5\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"32\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/appinit/#rsh_init\" title=\"rsh: init\"><span style=\"color: var(--shiki-token-function)\">init</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"33\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">D</span><a href=\"/rsh/step/#rsh_only\" title=\"rsh: only\"><span style=\"color: var(--shiki-token-function)\">.only</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> {</span><span style=\"color: var(--shiki-token-constant)\">name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">symbol</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">decimals</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">totalSupply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">zeroAddress</span><span style=\"color: var(--shiki-color-text)\">} </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/local/#rsh_declassify\" title=\"rsh: declassify\"><span style=\"color: var(--shiki-token-function)\">declassify</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-color-text)\">.meta);</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">D</span><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-token-function)\">.publish</span></a><span style=\"color: var(--shiki-color-text)\">(name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> symbol</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> decimals</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> totalSupply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> zeroAddress)</span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">.check</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(decimals </span><a href=\"/rsh/compute/#rsh_%3C\" title=\"rsh: <\"><span style=\"color: var(--shiki-token-keyword)\">&lt;</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">256</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'decimals fits in UInt8'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">  });</span></li></ol></pre>\n<p>\n  <i id=\"p_25\" class=\"pid\"></i>Then, the Deployer notifies the frontend that the contract is deployed.\n  <span class=\"snip\"><a href=\"/rsh/compute/#rsh_getContract\" title=\"rsh: getContract\"><span style=\"color: var(--shiki-token-function)\">getContract</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span> will return the contract value, it cannot be called until after the first <span class=\"snip\"><a href=\"/rsh/step/#rsh_publish\" title=\"rsh: publish\"><span style=\"color: var(--shiki-color-text)\">publish</span></a></span>.<a href=\"#p_25\" class=\"pid\">25</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  D.interact.launched(getContract());\" href=\"#\" id=\"copyBtn6\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">D</span><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/rsh/local/#rsh_interact\" title=\"rsh: interact\"><span style=\"color: var(--shiki-token-constant)\">interact</span></a><span style=\"color: var(--shiki-token-function)\">.launched</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_getContract\" title=\"rsh: getContract\"><span style=\"color: var(--shiki-token-function)\">getContract</span></a><span style=\"color: var(--shiki-color-text)\">());</span></li></ol></pre>\n<p><i id=\"p_26\" class=\"pid\"></i>Now, we can set the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>s related to our token metadata.<a href=\"#p_26\" class=\"pid\">26</a></p>\n<p><i id=\"p_27\" class=\"pid\"></i>This information is already available, because we published it to the blockchain, but it is accessible with some difficulty.<a href=\"#p_27\" class=\"pid\">27</a></p>\n<p><i id=\"p_28\" class=\"pid\"></i><span class=\"snip\"><a href=\"/rsh/appinit/#rsh_View\" title=\"rsh: View\"><span style=\"color: var(--shiki-color-text)\">View</span></a></span>s make this as simple as defining a function to provide the information to the frontend.<a href=\"#p_28\" class=\"pid\">28</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  V.name.set(() => name);\n  V.symbol.set(() => symbol);\n  V.decimals.set(() => decimals);\n  V.totalSupply.set(() => totalSupply);\" href=\"#\" id=\"copyBtn7\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">name</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> name);</span></li><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">symbol</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> symbol);</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">decimals</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> decimals);</span></li><li value=\"44\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">totalSupply</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> totalSupply);</span></li></ol></pre>\n<p><i id=\"p_29\" class=\"pid\"></i>Next, we'll create the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a></span>s that hold balances and allowances for transfer.<a href=\"#p_29\" class=\"pid\">29</a></p>\n<ul>\n  <li><i id=\"p_30\" class=\"pid\"></i>The <code>balances</code> map will be our database of ownership, so we set the balance map for the deployer to the <code>totalSupply</code>.<a href=\"#p_30\" class=\"pid\">30</a></li>\n  <li><i id=\"p_31\" class=\"pid\"></i>The <code>allowances</code> map will hold the allowed amount of tokens to be transferred by an address.<a href=\"#p_31\" class=\"pid\">31</a></li>\n</ul>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const balances = new Map(Address, UInt);\n  const allowances = new Map(Tuple(Address, Address), UInt);\n\n  balances[D] = totalSupply;\" href=\"#\" id=\"copyBtn8\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">balances</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_new\" title=\"rsh: new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt);</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">allowances</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_Map.new\" title=\"rsh: Map.new\"><span style=\"color: var(--shiki-token-keyword)\">new</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_Tuple\" title=\"rsh: Tuple\"><span style=\"color: var(--shiki-token-function)\">Tuple</span></a><span style=\"color: var(--shiki-color-text)\">(Address</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> Address)</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> UInt);</span></li><li value=\"48\"></li><li value=\"49\"><span style=\"color: var(--shiki-color-text)\">  balances[</span><span style=\"color: var(--shiki-token-constant)\">D</span><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> totalSupply;</span></li></ol></pre>\n<p><i id=\"p_32\" class=\"pid\"></i>Next, we'll emit the event for Transfer from the zero address.<a href=\"#p_32\" class=\"pid\">32</a></p>\n<p><i id=\"p_33\" class=\"pid\"></i>Events emit at significant actions of the program, they allow monitoring of Reach program actions.<a href=\"#p_33\" class=\"pid\">33</a></p>\n<p><i id=\"p_34\" class=\"pid\"></i>This event shows the token has been minted and given initial state.<a href=\"#p_34\" class=\"pid\">34</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  E.Transfer(zeroAddress, D, totalSupply);\" href=\"#\" id=\"copyBtn9\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"50\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-token-function)\">.Transfer</span><span style=\"color: var(--shiki-color-text)\">(zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">D</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> totalSupply);</span></li></ol></pre>\n<h2 id=\"an-erc20-testing-frontend\" class=\"refHeader\">An ERC20 Testing Frontend<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#an-erc20-testing-frontend\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_35\" class=\"pid\"></i>Before we go any further in our Reach (<code>rsh</code>) file, let's jump into the frontend (<code>mjs</code>) file.<a href=\"#p_35\" class=\"pid\">35</a></p>\n<p><i id=\"p_36\" class=\"pid\"></i>We'll start with necessary imports and ensure that we're running on an Ethereum-based network:<a href=\"#p_36\" class=\"pid\">36</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"import * as backend from './build/index.main.mjs';\nimport { loadStdlib } from &quot;@reach-sh/stdlib&quot;;\nconst stdlib = loadStdlib({REACH_NO_WARN: 'Y'});\n\nif(stdlib.connector !== 'ETH'){\n  console.log('Sorry, this program is only compiled on ETH for now');\n  process.exit(0);\n};\" href=\"#\" id=\"copyBtn10\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">*</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">as</span><span style=\"color: var(--shiki-color-text)\"> backend </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'./build/index.main.mjs'</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"2\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\" title=\"js: import\"><span style=\"color: var(--shiki-token-keyword)\">import</span></a><span style=\"color: var(--shiki-color-text)\"> { loadStdlib } </span><span style=\"color: var(--shiki-token-keyword)\">from</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"@reach-sh/stdlib\"</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"3\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_loadStdlib\" title=\"js: loadStdlib\"><span style=\"color: var(--shiki-token-function)\">loadStdlib</span></a><span style=\"color: var(--shiki-color-text)\">({REACH_NO_WARN</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'Y'</span><span style=\"color: var(--shiki-color-text)\">});</span></li><li value=\"4\"></li><li value=\"5\"><span style=\"color: var(--shiki-token-keyword)\">if</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\">.connector </span><span style=\"color: var(--shiki-token-keyword)\">!==</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'ETH'</span><span style=\"color: var(--shiki-color-text)\">){</span></li><li value=\"6\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Sorry, this program is only compiled on ETH for now'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"7\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">process</span><span style=\"color: var(--shiki-token-function)\">.exit</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"8\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p><i id=\"p_37\" class=\"pid\"></i>Our frontend is primarily going to be a test suite, so we'll define some testing functions:<a href=\"#p_37\" class=\"pid\">37</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const assert = stdlib.assert;\nconst bigNumberify = stdlib.bigNumberify;\" href=\"#\" id=\"copyBtn11\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"11\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_assert\" title=\"js: assert\"><span style=\"color: var(--shiki-token-constant)\">assert</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\">.assert;</span></li><li value=\"12\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_bigNumberify\" title=\"js: bigNumberify\"><span style=\"color: var(--shiki-token-constant)\">bigNumberify</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><span style=\"color: var(--shiki-color-text)\">.bigNumberify;</span></li></ol></pre>\n<p>\n  <i id=\"p_38\" class=\"pid\"></i>Next, let's write some test functions.\n  We, of course want, to test that they pass when we assume they will, but we also want to check our assumptions about when we expect them to fail.<a href=\"#p_38\" class=\"pid\">38</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const assertFail = async (promise) => {\n  try {\n    await promise;\n  } catch (e) {\n    return;\n  }\n  throw &quot;Expected exception but did not catch one&quot;;\n};\" href=\"#\" id=\"copyBtn12\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"14\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertFail</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (promise) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"15\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">try</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"16\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> promise;</span></li><li value=\"17\"><span style=\"color: var(--shiki-color-text)\">  } </span><span style=\"color: var(--shiki-token-keyword)\">catch</span><span style=\"color: var(--shiki-color-text)\"> (e) {</span></li><li value=\"18\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"19\"><span style=\"color: var(--shiki-color-text)\">  }</span></li><li value=\"20\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">throw</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"Expected exception but did not catch one\"</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"21\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p>\n  <i id=\"p_39\" class=\"pid\"></i>Next we define a helper function to check that values are identical.\n  We have a special case for numbers, because the <span class=\"snip\"><span style=\"color: var(--shiki-token-keyword)\">===</span></span> operation does not work on <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">BigNumber</span></span>s.<a href=\"#p_39\" class=\"pid\">39</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const assertEq = (a, b, context = &quot;assertEq&quot;) => {\n  if (a === b) return;\n  try {\n    const res1BN = bigNumberify(a);\n    const res2BN = bigNumberify(b);\n    if (res1BN.eq(res2BN)) return;\n  } catch {}\n  assert(false, `${context}: ${a} == ${b}`);\n};\" href=\"#\" id=\"copyBtn13\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"23\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (a</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> b</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> context </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"assertEq\"</span><span style=\"color: var(--shiki-color-text)\">) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"24\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">if</span><span style=\"color: var(--shiki-color-text)\"> (a </span><span style=\"color: var(--shiki-token-keyword)\">===</span><span style=\"color: var(--shiki-color-text)\"> b) </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"25\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">try</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"26\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">res1BN</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_bigNumberify\" title=\"js: bigNumberify\"><span style=\"color: var(--shiki-token-function)\">bigNumberify</span></a><span style=\"color: var(--shiki-color-text)\">(a);</span></li><li value=\"27\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">res2BN</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_bigNumberify\" title=\"js: bigNumberify\"><span style=\"color: var(--shiki-token-function)\">bigNumberify</span></a><span style=\"color: var(--shiki-color-text)\">(b);</span></li><li value=\"28\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">if</span><span style=\"color: var(--shiki-color-text)\"> (</span><span style=\"color: var(--shiki-token-constant)\">res1BN</span><a href=\"/frontend/#js_eq\" title=\"js: eq\"><span style=\"color: var(--shiki-token-function)\">.eq</span></a><span style=\"color: var(--shiki-color-text)\">(res2BN)) </span><span style=\"color: var(--shiki-token-keyword)\">return</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"29\"><span style=\"color: var(--shiki-color-text)\">  } </span><span style=\"color: var(--shiki-token-keyword)\">catch</span><span style=\"color: var(--shiki-color-text)\"> {}</span></li><li value=\"30\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/frontend/#js_assert\" title=\"js: assert\"><span style=\"color: var(--shiki-token-function)\">assert</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">false</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">context</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">: </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">a</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> == </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">b</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"31\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p><i id=\"p_40\" class=\"pid\"></i>Now, we create the <a href=\"https://youtu.be/7JR10AThY8M\" target=\"_blank\">startMeUp</a> function to handle deploying our contract and any errors we may encounter.<a href=\"#p_40\" class=\"pid\">40</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const startMeUp = async (ctc, meta) => {\n  const flag = &quot;startup success throw flag&quot;\n  try {\n    await ctc.p.Deployer({\n      meta,\n      launched: (ctc) => {\n        throw flag;\n      },\n    });\n  } catch (e) {\n    if ( e !== flag) {\n      throw e;\n    }\n  }\n};\" href=\"#\" id=\"copyBtn14\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"33\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">startMeUp</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (ctc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> meta) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"34\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">flag</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"startup success throw flag\"</span></li><li value=\"35\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-keyword)\">try</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"36\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-constant)\">ctc</span></a><span style=\"color: var(--shiki-token-function)\">.</span><a href=\"/frontend/#js_ctc.p\" title=\"js: ctc.p\"><span style=\"color: var(--shiki-token-constant)\">p</span></a><span style=\"color: var(--shiki-token-function)\">.Deployer</span><span style=\"color: var(--shiki-color-text)\">({</span></li><li value=\"37\"><span style=\"color: var(--shiki-color-text)\">      meta</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"38\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-function)\">launched</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> (ctc) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"39\"><span style=\"color: var(--shiki-color-text)\">        </span><span style=\"color: var(--shiki-token-keyword)\">throw</span><span style=\"color: var(--shiki-color-text)\"> flag;</span></li><li value=\"40\"><span style=\"color: var(--shiki-color-text)\">      }</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"41\"><span style=\"color: var(--shiki-color-text)\">    });</span></li><li value=\"42\"><span style=\"color: var(--shiki-color-text)\">  } </span><span style=\"color: var(--shiki-token-keyword)\">catch</span><span style=\"color: var(--shiki-color-text)\"> (e) {</span></li><li value=\"43\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-keyword)\">if</span><span style=\"color: var(--shiki-color-text)\"> ( e </span><span style=\"color: var(--shiki-token-keyword)\">!==</span><span style=\"color: var(--shiki-color-text)\"> flag) {</span></li><li value=\"44\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-keyword)\">throw</span><span style=\"color: var(--shiki-color-text)\"> e;</span></li><li value=\"45\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"46\"><span style=\"color: var(--shiki-color-text)\">  }</span></li><li value=\"47\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p><i id=\"p_41\" class=\"pid\"></i>Then, we define the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">zeroAddress</span></span> and create our test accounts:<a href=\"#p_41\" class=\"pid\">41</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const zeroAddress = &quot;0x&quot; + &quot;0&quot;.repeat(40);\nconst accs = await stdlib.newTestAccounts(4, stdlib.parseCurrency(100));\nconst [acc0, acc1, acc2, acc3] = accs;\nconst [addr0, addr1, addr2, addr3] = accs.map(a => a.getAddress());\" href=\"#\" id=\"copyBtn15\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"49\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">zeroAddress</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"0x\"</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">+</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"0\"</span><span style=\"color: var(--shiki-token-function)\">.repeat</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">40</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"50\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accs</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_stdlib.newTestAccounts\" title=\"js: stdlib.newTestAccounts\"><span style=\"color: var(--shiki-token-function)\">.newTestAccounts</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">4</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_parseCurrency\" title=\"js: parseCurrency\"><span style=\"color: var(--shiki-token-function)\">.parseCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">100</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"51\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [</span><span style=\"color: var(--shiki-token-constant)\">acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">acc3</span><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> accs;</span></li><li value=\"52\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [</span><span style=\"color: var(--shiki-token-constant)\">addr0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">addr1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">addr2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">addr3</span><span style=\"color: var(--shiki-color-text)\">] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">accs</span><span style=\"color: var(--shiki-token-function)\">.map</span><span style=\"color: var(--shiki-color-text)\">(a </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">a</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">());</span></li></ol></pre>\n<p><i id=\"p_42\" class=\"pid\"></i>Now, we can setup our token metadata in an object to eventually be passed to the backend:<a href=\"#p_42\" class=\"pid\">42</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const totalSupply = 100_000;\nconst decimals = 2;\nconst meta = {\n  name: &quot;Coinzz&quot;,\n  symbol: &quot;CZZ&quot;,\n  decimals,\n  totalSupply,\n  zeroAddress,\n};\" href=\"#\" id=\"copyBtn16\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"54\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">totalSupply</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">100_000</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"55\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">decimals</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">2</span><span style=\"color: var(--shiki-color-text)\">;</span></li><li value=\"56\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">meta</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">  name</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"Coinzz\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">  symbol</span><span style=\"color: var(--shiki-token-keyword)\">:</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"CZZ\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">  decimals</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">  totalSupply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">  zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p>\n  <i id=\"p_43\" class=\"pid\"></i>Now, that we have our Deployer account and token data, we can deploy the contract and send this info to the backend.\n  We'll use <code>acc0</code> as the Deployer:<a href=\"#p_43\" class=\"pid\">43</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const ctc0 = acc0.contract(backend);\nawait startMeUp(ctc0, meta);\nconsole.log('Completed startMeUp');\n\nconst ctcinfo = await ctc0.getInfo();\nconst ctc = (acc) => acc.contract(backend, ctcinfo);\" href=\"#\" id=\"copyBtn17\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"64\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">acc0</span><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend);</span></li><li value=\"65\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">startMeUp</span><span style=\"color: var(--shiki-color-text)\">(ctc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> meta);</span></li><li value=\"66\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'Completed startMeUp'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"67\"></li><li value=\"68\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctcinfo</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><a href=\"/frontend/#js_getInfo\" title=\"js: getInfo\"><span style=\"color: var(--shiki-token-function)\">.getInfo</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"69\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-function)\">ctc</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (acc) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_acc\" title=\"js: acc\"><span style=\"color: var(--shiki-token-constant)\">acc</span></a><a href=\"/frontend/#js_contract\" title=\"js: contract\"><span style=\"color: var(--shiki-token-function)\">.contract</span></a><span style=\"color: var(--shiki-color-text)\">(backend</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> ctcinfo);</span></li></ol></pre>\n<p>\n  <i id=\"p_44\" class=\"pid\"></i>We have all of our users created now and the contract is deployed.\n  Now, we can go back to our <code>.rsh</code> file.<a href=\"#p_44\" class=\"pid\">44</a>\n</p>\n<h2 id=\"the-erc20-apis-in-reach\" class=\"refHeader\">The ERC20 APIs in Reach<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-erc20-apis-in-reach\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_45\" class=\"pid\"></i>The next thing we want to do is create the functionality for our <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span>s.\n  Given that we have many users who need to do something, we will use a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span>.\n  <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> is a powerful control structure, it will allow users to repeatedly call <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span>s in a looping construct.\n  We could use a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> loop with a <span class=\"snip\"><a href=\"/rsh/step/#rsh_fork\" title=\"rsh: fork\"><span style=\"color: var(--shiki-color-text)\">fork</span></a></span>, but <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> is a more convenient way to write it.<a href=\"#p_45\" class=\"pid\">45</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  const [] = parallelReduce([])\" href=\"#\" id=\"copyBtn18\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"52\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> [] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-token-function)\">parallelReduce</span></a><span style=\"color: var(--shiki-color-text)\">([])</span></li></ol></pre>\n<p><i id=\"p_46\" class=\"pid\"></i>The only values that need to be tracked in the program are the balances and allowances, so the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> does not track any values.<a href=\"#p_46\" class=\"pid\">46</a></p>\n<p><i id=\"p_47\" class=\"pid\"></i>The <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">define</span></span> block of our <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> will be used to define some helper functions.<a href=\"#p_47\" class=\"pid\">47</a></p>\n<p><i id=\"p_48\" class=\"pid\"></i>First, a function to check the balance and set the related View.<a href=\"#p_48\" class=\"pid\">48</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .define(() => {\n    const balanceOf = (owner) => {\n      const m_bal = balances[owner];\n      return fromSome(m_bal, 0);\n    }\n    V.balanceOf.set(balanceOf);\" href=\"#\" id=\"copyBtn19\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">.define</span><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (owner) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">m_bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> balances[owner];</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">(m_bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">balanceOf</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(balanceOf);</span></li></ol></pre>\n<div class=\"note\">\n  <p><i id=\"p_49\" class=\"pid\"></i>Why do we use <span class=\"snip\"><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span> here?<a href=\"#p_49\" class=\"pid\">49</a></p>\n  <p>\n    <i id=\"p_50\" class=\"pid\"></i>The keys of a <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_Map\" title=\"rsh: Map\"><span style=\"color: var(--shiki-token-constant)\">Map</span></a></span> (i.e. <code>balances</code> and <code>allowances</code>) may not exist, so Reach returns an option type:\n    <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-color-text)\">Maybe</span></a></span> which has two possibilities: <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">Some</span></span> (present) and <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">None</span></span> (not present).\n    Reach provides the <span class=\"snip\"><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">()</span></span> function to easily consume these <span class=\"snip\"><a href=\"/rsh/compute/#rsh_Maybe\" title=\"rsh: Maybe\"><span style=\"color: var(--shiki-color-text)\">Maybe</span></a></span> values, returning a default value in the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">None</span></span> case.<a href=\"#p_50\" class=\"pid\">50</a>\n  </p>\n</div>\n<p><i id=\"p_51\" class=\"pid\"></i>Next, we also set the allowances of each account:<a href=\"#p_51\" class=\"pid\">51</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .define(() => {\n    const balanceOf = (owner) => {\n      const m_bal = balances[owner];\n      return fromSome(m_bal, 0);\n    }\n    V.balanceOf.set(balanceOf);\n    const allowance = (owner, spender) => {\n      const m_bal = allowances[[owner, spender]];\n      return fromSome(m_bal, 0);\n    }\n    V.allowance.set(allowance);\" href=\"#\" id=\"copyBtn20\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">.define</span><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (owner) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">m_bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> balances[owner];</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">(m_bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">balanceOf</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(balanceOf);</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">allowance</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (owner</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spender) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">m_bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> allowances[[owner</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spender]];</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">(m_bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">allowance</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(allowance);</span></li></ol></pre>\n<p><i id=\"p_52\" class=\"pid\"></i>Finally, we define a helper function for doing transfers, which emits the <code>Transfer</code> event, as required by the ERC20 spec.<a href=\"#p_52\" class=\"pid\">52</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .define(() => {\n    const balanceOf = (owner) => {\n      const m_bal = balances[owner];\n      return fromSome(m_bal, 0);\n    }\n    V.balanceOf.set(balanceOf);\n    const allowance = (owner, spender) => {\n      const m_bal = allowances[[owner, spender]];\n      return fromSome(m_bal, 0);\n    }\n    V.allowance.set(allowance);\n    const transfer_ = (from_, to, amount) => {\n      balances[from_] = balanceOf(from_) - amount;\n      balances[to] = balanceOf(to) + amount;\n      E.Transfer(from_, to, amount);\n    }\n  })\" href=\"#\" id=\"copyBtn21\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"53\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">.define</span><span style=\"color: var(--shiki-color-text)\">(() </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"54\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (owner) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"55\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">m_bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> balances[owner];</span></li><li value=\"56\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">(m_bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"57\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"58\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">balanceOf</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(balanceOf);</span></li><li value=\"59\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">allowance</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (owner</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spender) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"60\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">m_bal</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> allowances[[owner</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spender]];</span></li><li value=\"61\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_fromSome\" title=\"rsh: fromSome\"><span style=\"color: var(--shiki-token-function)\">fromSome</span></a><span style=\"color: var(--shiki-color-text)\">(m_bal</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"62\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"63\"><span style=\"color: var(--shiki-color-text)\">    </span><span style=\"color: var(--shiki-token-constant)\">V</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">allowance</span><a href=\"/rsh/compute/#rsh_set\" title=\"rsh: set\"><span style=\"color: var(--shiki-token-function)\">.set</span></a><span style=\"color: var(--shiki-color-text)\">(allowance);</span></li><li value=\"64\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">transfer_</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> (from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> to</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"65\"><span style=\"color: var(--shiki-color-text)\">      balances[from_] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\">(from_) </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> amount;</span></li><li value=\"66\"><span style=\"color: var(--shiki-color-text)\">      balances[to] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\">(to) </span><a href=\"/rsh/compute/#rsh_+\" title=\"rsh: +\"><span style=\"color: var(--shiki-token-keyword)\">+</span></a><span style=\"color: var(--shiki-color-text)\"> amount;</span></li><li value=\"67\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-token-function)\">.Transfer</span><span style=\"color: var(--shiki-color-text)\">(from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> to</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount);</span></li><li value=\"68\"><span style=\"color: var(--shiki-color-text)\">    }</span></li><li value=\"69\"><span style=\"color: var(--shiki-color-text)\">  })</span></li></ol></pre>\n<p><i id=\"p_53\" class=\"pid\"></i>After the <span class=\"snip\"><span style=\"color: var(--shiki-color-text)\">.define</span></span> block of the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span>, we set up the invariant (the balance never changes from zero) and the termination condition (never):<a href=\"#p_53\" class=\"pid\">53</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .invariant(balance() == 0)\n  .while(true)\" href=\"#\" id=\"copyBtn22\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"70\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_invariant\" title=\"rsh: invariant\"><span style=\"color: var(--shiki-token-function)\">.invariant</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_balance\" title=\"rsh: balance\"><span style=\"color: var(--shiki-token-function)\">balance</span></a><span style=\"color: var(--shiki-color-text)\">() </span><a href=\"/rsh/compute/#rsh_==\" title=\"rsh: ==\"><span style=\"color: var(--shiki-token-keyword)\">==</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">)</span></li><li value=\"71\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-function)\">.while</span></a><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">)</span></li></ol></pre>\n<hr>\n<p><i id=\"p_54\" class=\"pid\"></i>We can now define our <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span> member functions.<a href=\"#p_54\" class=\"pid\">54</a></p>\n<p><i id=\"p_55\" class=\"pid\"></i>The <code>transfer</code> is basic wrapper around the <code>transfer_</code> function with a few checks:<a href=\"#p_55\" class=\"pid\">55</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .api_(A.transfer, (to, amount) => {\n    check(to != zeroAddress, 'ERC20: Transfer to zero address');\n    check(balanceOf(this) >= amount, &quot;amount must not be greater than balance&quot;);\n    return[(k) => {\n      transfer_(this, to, amount);\n      k(true);\n      return [];\n    }];\n  })\" href=\"#\" id=\"copyBtn23\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"72\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">A</span><a href=\"/rsh/consensus/#rsh_transfer\" title=\"rsh: transfer\"><span style=\"color: var(--shiki-color-text)\">.transfer</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (to</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"73\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(to </span><a href=\"/rsh/compute/#rsh_!=\" title=\"rsh: !=\"><span style=\"color: var(--shiki-token-keyword)\">!=</span></a><span style=\"color: var(--shiki-color-text)\"> zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">'ERC20: Transfer to zero address'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"74\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">) </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> amount</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"amount must not be greater than balance\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"75\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\">[(k) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"76\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-function)\">transfer_</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> to</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount);</span></li><li value=\"77\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-function)\">k</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"78\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [];</span></li><li value=\"79\"><span style=\"color: var(--shiki-color-text)\">    }];</span></li><li value=\"80\"><span style=\"color: var(--shiki-color-text)\">  })</span></li></ol></pre>\n<p><i id=\"p_56\" class=\"pid\"></i>Next is the <code>transferFrom</code> function, which is like <code>transfer</code> but uses the <code>allowances</code> concept from the ERC20 standard:<a href=\"#p_56\" class=\"pid\">56</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .api_(A.transferFrom, (from_, to, amount) => {\n    check(from_ != zeroAddress, &quot;ERC20: Transfer from zero address&quot;);\n    check(to != zeroAddress, &quot;ERC20: Transfer to zero address&quot;);\n    check(balanceOf(from_) >= amount, &quot;amount must not be greater than balance&quot;);\n    check(allowance(from_, this) >= amount, &quot;amount must not be greater than allowance&quot;);\n    return[ (k) => {\n      transfer_(from_, to, amount);\n      const newAllowance = allowance(from_, this) - amount;\n      allowances[[from_, this]] = newAllowance;\n      E.Approval(from_, this, newAllowance);\n      k(true);\n      return [];\n    }];\n  })\" href=\"#\" id=\"copyBtn24\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"81\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\">.transferFrom</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> to</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"82\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(from_ </span><a href=\"/rsh/compute/#rsh_!=\" title=\"rsh: !=\"><span style=\"color: var(--shiki-token-keyword)\">!=</span></a><span style=\"color: var(--shiki-color-text)\"> zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"ERC20: Transfer from zero address\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"83\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(to </span><a href=\"/rsh/compute/#rsh_!=\" title=\"rsh: !=\"><span style=\"color: var(--shiki-token-keyword)\">!=</span></a><span style=\"color: var(--shiki-color-text)\"> zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"ERC20: Transfer to zero address\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"84\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">balanceOf</span><span style=\"color: var(--shiki-color-text)\">(from_) </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> amount</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"amount must not be greater than balance\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"85\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">allowance</span><span style=\"color: var(--shiki-color-text)\">(from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">) </span><a href=\"/rsh/compute/#rsh_%3E=\" title=\"rsh: >=\"><span style=\"color: var(--shiki-token-keyword)\">&gt;=</span></a><span style=\"color: var(--shiki-color-text)\"> amount</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"amount must not be greater than allowance\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"86\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\">[ (k) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"87\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-function)\">transfer_</span><span style=\"color: var(--shiki-color-text)\">(from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> to</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount);</span></li><li value=\"88\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_const\" title=\"rsh: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">newAllowance</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">allowance</span><span style=\"color: var(--shiki-color-text)\">(from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">) </span><a href=\"/rsh/compute/#rsh_-\" title=\"rsh: -\"><span style=\"color: var(--shiki-token-keyword)\">-</span></a><span style=\"color: var(--shiki-color-text)\"> amount;</span></li><li value=\"89\"><span style=\"color: var(--shiki-color-text)\">      allowances[[from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-color-text)\">]] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> newAllowance;</span></li><li value=\"90\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-token-function)\">.Approval</span><span style=\"color: var(--shiki-color-text)\">(from_</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> newAllowance);</span></li><li value=\"91\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-function)\">k</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"92\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [];</span></li><li value=\"93\"><span style=\"color: var(--shiki-color-text)\">    }];</span></li><li value=\"94\"><span style=\"color: var(--shiki-color-text)\">  })</span></li></ol></pre>\n<p><i id=\"p_57\" class=\"pid\"></i>In this case, we emit the <code>Approval</code> event, because the allowances changed.<a href=\"#p_57\" class=\"pid\">57</a></p>\n<p><i id=\"p_58\" class=\"pid\"></i>Finally, we have the <code>approve</code> function, which sets the allowances:<a href=\"#p_58\" class=\"pid\">58</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.rsh\">/examples/ERC20-simple/index.rsh</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"  .api_(A.approve, (spender, amount) => {\n    check(spender != zeroAddress, &quot;ERC20: Approve to zero address&quot;);\n    return [ (k) => {\n      allowances[[this, spender]] = amount;\n      E.Approval(this, spender, amount);\n      k(true);\n      return [];\n    }];\n  });\n  commit();\n  exit();\n});\" href=\"#\" id=\"copyBtn25\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"95\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">.api_</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">A</span><span style=\"color: var(--shiki-color-text)\">.approve</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (spender</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"96\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_check\" title=\"rsh: check\"><span style=\"color: var(--shiki-token-function)\">check</span></a><span style=\"color: var(--shiki-color-text)\">(spender </span><a href=\"/rsh/compute/#rsh_!=\" title=\"rsh: !=\"><span style=\"color: var(--shiki-token-keyword)\">!=</span></a><span style=\"color: var(--shiki-color-text)\"> zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"ERC20: Approve to zero address\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"97\"><span style=\"color: var(--shiki-color-text)\">    </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [ (k) </span><a href=\"/rsh/compute/#rsh_=%3E\" title=\"rsh: =>\"><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span></a><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"98\"><span style=\"color: var(--shiki-color-text)\">      allowances[[</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spender]] </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> amount;</span></li><li value=\"99\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-constant)\">E</span><span style=\"color: var(--shiki-token-function)\">.Approval</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_this\" title=\"rsh: this\"><span style=\"color: var(--shiki-token-constant)\">this</span></a><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spender</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amount);</span></li><li value=\"100\"><span style=\"color: var(--shiki-color-text)\">      </span><span style=\"color: var(--shiki-token-function)\">k</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"101\"><span style=\"color: var(--shiki-color-text)\">      </span><a href=\"/rsh/compute/#rsh_return\" title=\"rsh: return\"><span style=\"color: var(--shiki-token-keyword)\">return</span></a><span style=\"color: var(--shiki-color-text)\"> [];</span></li><li value=\"102\"><span style=\"color: var(--shiki-color-text)\">    }];</span></li><li value=\"103\"><span style=\"color: var(--shiki-color-text)\">  });</span></li><li value=\"104\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/consensus/#rsh_commit\" title=\"rsh: commit\"><span style=\"color: var(--shiki-token-function)\">commit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"105\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"/rsh/step/#rsh_exit\" title=\"rsh: exit\"><span style=\"color: var(--shiki-token-function)\">exit</span></a><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"106\"><span style=\"color: var(--shiki-color-text)\">});</span></li></ol></pre>\n<p><i id=\"p_59\" class=\"pid\"></i>This too emits an <code>Approval</code> event.<a href=\"#p_59\" class=\"pid\">59</a></p>\n<p><i id=\"p_60\" class=\"pid\"></i>(The final few lines are outside of the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_parallelReduce\" title=\"rsh: parallelReduce\"><span style=\"color: var(--shiki-color-text)\">parallelReduce</span></a></span> and simply <span class=\"snip\"><a href=\"/rsh/step/#rsh_exit\" title=\"rsh: exit\"><span style=\"color: var(--shiki-color-text)\">exit</span></a></span>, which will never happen because the <span class=\"snip\"><a href=\"/rsh/consensus/#rsh_while\" title=\"rsh: while\"><span style=\"color: var(--shiki-token-keyword)\">while</span></a></span> condition is <span class=\"snip\"><a href=\"/rsh/compute/#rsh_true\" title=\"rsh: true\"><span style=\"color: var(--shiki-token-constant)\">true</span></a></span>.<a href=\"#p_60\" class=\"pid\">60</a></p>\n<h2 id=\"the-rest-of-the-erc20-test-suite\" class=\"refHeader\">The Rest of the ERC20 Test Suite<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#the-rest-of-the-erc20-test-suite\"><span class=\"icon icon-link\"></span></a></h2>\n<p><i id=\"p_61\" class=\"pid\"></i>We can jump back to our frontend and implement some tests for our new functions.<a href=\"#p_61\" class=\"pid\">61</a></p>\n<p><i id=\"p_62\" class=\"pid\"></i>First, we define a function to verify assertions about the balances of our accounts:<a href=\"#p_62\" class=\"pid\">62</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const assertBalances = async (bal0, bal1, bal2, bal3) => {\n  assertEq(bal0, (await ctc0.v.balanceOf(acc0.getAddress()))[1]);\n  assertEq(bal1, (await ctc0.v.balanceOf(acc1.getAddress()))[1]);\n  assertEq(bal2, (await ctc0.v.balanceOf(acc2.getAddress()))[1]);\n  assertEq(bal3, (await ctc0.v.balanceOf(acc3.getAddress()))[1]);\n  console.log('assertBalances complete');\n};\" href=\"#\" id=\"copyBtn26\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"71\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertBalances</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (bal0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bal1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bal2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> bal3) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"72\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">(bal0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><a href=\"/frontend/#js_balanceOf\" title=\"js: balanceOf\"><span style=\"color: var(--shiki-token-function)\">.balanceOf</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">acc0</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]);</span></li><li value=\"73\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">(bal1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><a href=\"/frontend/#js_balanceOf\" title=\"js: balanceOf\"><span style=\"color: var(--shiki-token-function)\">.balanceOf</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">acc1</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]);</span></li><li value=\"74\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">(bal2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><a href=\"/frontend/#js_balanceOf\" title=\"js: balanceOf\"><span style=\"color: var(--shiki-token-function)\">.balanceOf</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">acc2</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]);</span></li><li value=\"75\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">(bal3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> (</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><a href=\"/frontend/#js_balanceOf\" title=\"js: balanceOf\"><span style=\"color: var(--shiki-token-function)\">.balanceOf</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">acc3</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]);</span></li><li value=\"76\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'assertBalances complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"77\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p><i id=\"p_63\" class=\"pid\"></i>Next, we define a function to ensure that an event actually occurred:<a href=\"#p_63\" class=\"pid\">63</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const assertEvent = async (event, ...expectedArgs) => {\n  const e = await ctc0.events[event].next();\n  const actualArgs = e.what;\n  expectedArgs.forEach((expectedArg, i) => assertEq(actualArgs[i], expectedArg, `${event} field ${i}`));\n  console.log('assertEvent complete');\n};\" href=\"#\" id=\"copyBtn27\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"79\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEvent</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (event</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">...</span><span style=\"color: var(--shiki-color-text)\">expectedArgs) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"80\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">e</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-color-text)\">.events[event]</span><span style=\"color: var(--shiki-token-function)\">.next</span><span style=\"color: var(--shiki-color-text)\">();</span></li><li value=\"81\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">actualArgs</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">e</span><span style=\"color: var(--shiki-color-text)\">.what;</span></li><li value=\"82\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">expectedArgs</span><span style=\"color: var(--shiki-token-function)\">.forEach</span><span style=\"color: var(--shiki-color-text)\">((expectedArg</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> i) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">(actualArgs[i]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> expectedArg</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">event</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\"> field </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">i</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"83\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'assertEvent complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"84\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<p><i id=\"p_64\" class=\"pid\"></i>Finally, we define wrappers around each of the <span class=\"snip\"><a href=\"/rsh/appinit/#rsh_API\" title=\"rsh: API\"><span style=\"color: var(--shiki-token-constant)\">API</span></a></span> calls, but wrap them in a few test assertions related to the events that we expect to be generated:<a href=\"#p_64\" class=\"pid\">64</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"const transfer = async (fromAcc, toAcc, amt) => {\n  await ctc(fromAcc).a.transfer(toAcc.getAddress(), amt);\n  await assertEvent(&quot;Transfer&quot;, fromAcc.getAddress(), toAcc.getAddress(), amt);\n  stdlib.transfer(fromAcc, toAcc, stdlib.parseCurrency(amt));\n  console.log('transfer complete');\n};\n\nconst transferFrom = async (spenderAcc, fromAcc, toAcc, amt, allowanceLeft) => {\n  const b = await ctc(spenderAcc).a.transferFrom(fromAcc.getAddress(), toAcc.getAddress(), amt);\n  await assertEvent(&quot;Transfer&quot;, fromAcc.getAddress(), toAcc.getAddress(), amt);\n  await assertEvent(&quot;Approval&quot;, fromAcc.getAddress(), spenderAcc.getAddress(), allowanceLeft);\n  console.log(`transferFrom complete is ${b}`);\n};\n\nconst approve = async (fromAcc, spenderAcc, amt) => {\n  await ctc(fromAcc).a.approve(spenderAcc.getAddress(), amt);\n  await assertEvent(&quot;Approval&quot;, fromAcc.getAddress(), spenderAcc.getAddress(), amt);\n  console.log('approve complete');\n};\" href=\"#\" id=\"copyBtn28\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"86\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (fromAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> toAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"87\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-function)\">ctc</span></a><span style=\"color: var(--shiki-color-text)\">(fromAcc).</span><a href=\"/frontend/#js_ctc.a\" title=\"js: ctc.a\"><span style=\"color: var(--shiki-token-constant)\">a</span></a><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">.transfer</span></a><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">toAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"88\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEvent</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Transfer\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">fromAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">toAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"89\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">.transfer</span></a><span style=\"color: var(--shiki-color-text)\">(fromAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> toAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">stdlib</span><a href=\"/frontend/#js_parseCurrency\" title=\"js: parseCurrency\"><span style=\"color: var(--shiki-token-function)\">.parseCurrency</span></a><span style=\"color: var(--shiki-color-text)\">(amt));</span></li><li value=\"90\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'transfer complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"91\"><span style=\"color: var(--shiki-color-text)\">};</span></li><li value=\"92\"></li><li value=\"93\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (spenderAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> fromAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> toAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> allowanceLeft) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"94\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">b</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-function)\">ctc</span></a><span style=\"color: var(--shiki-color-text)\">(spenderAcc).</span><a href=\"/frontend/#js_ctc.a\" title=\"js: ctc.a\"><span style=\"color: var(--shiki-token-constant)\">a</span></a><span style=\"color: var(--shiki-token-function)\">.transferFrom</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">fromAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">toAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"95\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEvent</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Transfer\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">fromAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">toAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"96\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEvent</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Approval\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">fromAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">spenderAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> allowanceLeft);</span></li><li value=\"97\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">`transferFrom complete is </span><span style=\"color: var(--shiki-token-keyword)\">${</span><span style=\"color: var(--shiki-color-text)\">b</span><span style=\"color: var(--shiki-token-keyword)\">}</span><span style=\"color: var(--shiki-token-string-expression)\">`</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"98\"><span style=\"color: var(--shiki-color-text)\">};</span></li><li value=\"99\"></li><li value=\"100\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const\" title=\"js: const\"><span style=\"color: var(--shiki-token-keyword)\">const</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">approve</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\" title=\"js: async\"><span style=\"color: var(--shiki-token-keyword)\">async</span></a><span style=\"color: var(--shiki-color-text)\"> (fromAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> spenderAcc</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt) </span><span style=\"color: var(--shiki-token-keyword)\">=&gt;</span><span style=\"color: var(--shiki-color-text)\"> {</span></li><li value=\"101\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_ctc\" title=\"js: ctc\"><span style=\"color: var(--shiki-token-function)\">ctc</span></a><span style=\"color: var(--shiki-color-text)\">(fromAcc).</span><a href=\"/frontend/#js_ctc.a\" title=\"js: ctc.a\"><span style=\"color: var(--shiki-token-constant)\">a</span></a><span style=\"color: var(--shiki-token-function)\">.approve</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-constant)\">spenderAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"102\"><span style=\"color: var(--shiki-color-text)\">  </span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEvent</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Approval\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">fromAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">spenderAcc</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> amt);</span></li><li value=\"103\"><span style=\"color: var(--shiki-color-text)\">  </span><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'approve complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"104\"><span style=\"color: var(--shiki-color-text)\">};</span></li></ol></pre>\n<hr>\n<p>\n  <i id=\"p_65\" class=\"pid\"></i>Finally, we can add some tests our program!\n  Each test is annotated with some explanation of what its purpose is:<a href=\"#p_65\" class=\"pid\">65</a>\n</p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\"><a href=\"https://github.com/reach-sh/reach-lang/tree/master/examples/ERC20-simple/index.mjs\">/examples/ERC20-simple/index.mjs</a><a class=\"far fa-copy copyBtn\" data-clipboard-text=\"console.log(&quot;Starting tests...&quot;);\n\n// initial transfer event upon minting (when launching contract)\nawait assertEvent(&quot;Transfer&quot;, zeroAddress, acc0.getAddress(), totalSupply);\nconsole.log('assertEvent call complete');\n\n// assert balances are equal to view values\n// acc0 has the totalSupply at this point, all others are zero\nawait assertBalances(totalSupply, 0, 0, 0);\nconsole.log('assertBalances call complete');\n\n// transfer of more than you have should fail\nawait assertFail(transfer(acc1, acc2, 10));\nawait assertFail(transferFrom(acc1, acc2, acc3, 10, 0));\nconsole.log('assertFail2 call complete');\n\n// transfer of zero should work even if you don't have any\nawait transfer(acc1, acc2, 0);\nconsole.log('transfer call complete');\n\n// transferFrom of zero should work even the from doesn't have any and the transferer has an allowance of 0\nawait transferFrom(acc1, acc2, acc3, 0, 0);\nconsole.log('transferFrom call complete');\n\n// transfer 10 from acc0 to acc1\nawait transfer(acc0, acc1, 10);\n// assert balances are correct after transfer\nawait assertBalances(totalSupply - 10, 10, 0, 0);\n\n// assert the allowance for addr3 is 0\nassertEq((await ctc0.v.allowance(addr0, addr3))[1], 0);\n// approve the allowance for add3 to 20\nawait approve(acc0, acc3, 20);\n// assert that allowance is correct\nassertEq((await ctc0.v.allowance(addr0, addr3))[1], 20);\n// check the balances again -- they haven't changed\nawait assertBalances(totalSupply - 10, 10, 0, 0);\n\n// transferFrom of more than an allowance should fail\nawait assertFail(transferFrom(acc3, acc0, acc2, 100, 20));\n\n// transferFrom spender, from, to, 10\nawait transferFrom(acc3, acc0, acc2, 10, 10);\n// assert the allowance for addr3\nassertEq((await ctc0.v.allowance(addr0, addr3))[1], 10);\n// assertBalances updated after transfer\nawait assertBalances(totalSupply - 20, 10, 10, 0);\n// transfer the 10 from acc3 back to acc0\nawait transferFrom(acc3, acc0, acc3, 10, 0);\n// assert the allowance has changed\nassertEq((await ctc0.v.allowance(addr0, addr3))[1], 0);\n// check the balances\nawait assertBalances(totalSupply - 30, 10, 10, 10);\n// transferFrom should use up the allowance\nawait assertFail(transferFrom(acc3, acc0, acc3, 1, 0));\n\n// Even if you're rich, you can't transfer more than your balance.\nawait assertFail(transfer(acc0, acc2, totalSupply - 10));\n\n// approve allowance of 100 tokens to acc0\nawait approve(acc0, acc1, 100);\n\n// assert the view values are as expected\nassertEq((await ctc0.v.name())[1], meta.name, &quot;name()&quot;);\nassertEq((await ctc0.v.symbol())[1], meta.symbol, &quot;symbol()&quot;);\nassertEq((await ctc0.v.totalSupply())[1], meta.totalSupply, &quot;totalSupply()&quot;);\nassertEq((await ctc0.v.decimals())[1], meta.decimals, &quot;decimals()&quot;);\n\nconsole.log(&quot;Finished testing!&quot;);\" href=\"#\" id=\"copyBtn29\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"107\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Starting tests...\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"108\"></li><li value=\"109\"><span style=\"color: var(--shiki-token-comment)\">// initial transfer event upon minting (when launching contract)</span></li><li value=\"110\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertEvent</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Transfer\"</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> zeroAddress</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">acc0</span><a href=\"/frontend/#js_getAddress\" title=\"js: getAddress\"><span style=\"color: var(--shiki-token-function)\">.getAddress</span></a><span style=\"color: var(--shiki-color-text)\">()</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> totalSupply);</span></li><li value=\"111\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'assertEvent call complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"112\"></li><li value=\"113\"><span style=\"color: var(--shiki-token-comment)\">// assert balances are equal to view values</span></li><li value=\"114\"><span style=\"color: var(--shiki-token-comment)\">// acc0 has the totalSupply at this point, all others are zero</span></li><li value=\"115\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertBalances</span><span style=\"color: var(--shiki-color-text)\">(totalSupply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"116\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'assertBalances call complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"117\"></li><li value=\"118\"><span style=\"color: var(--shiki-token-comment)\">// transfer of more than you have should fail</span></li><li value=\"119\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertFail</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"120\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertFail</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\">(acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"121\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'assertFail2 call complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"122\"></li><li value=\"123\"><span style=\"color: var(--shiki-token-comment)\">// transfer of zero should work even if you don't have any</span></li><li value=\"124\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"125\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'transfer call complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"126\"></li><li value=\"127\"><span style=\"color: var(--shiki-token-comment)\">// transferFrom of zero should work even the from doesn't have any and the transferer has an allowance of 0</span></li><li value=\"128\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\">(acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"129\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">'transferFrom call complete'</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"130\"></li><li value=\"131\"><span style=\"color: var(--shiki-token-comment)\">// transfer 10 from acc0 to acc1</span></li><li value=\"132\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"133\"><span style=\"color: var(--shiki-token-comment)\">// assert balances are correct after transfer</span></li><li value=\"134\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertBalances</span><span style=\"color: var(--shiki-color-text)\">(totalSupply </span><span style=\"color: var(--shiki-token-keyword)\">-</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"135\"></li><li value=\"136\"><span style=\"color: var(--shiki-token-comment)\">// assert the allowance for addr3 is 0</span></li><li value=\"137\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.allowance</span><span style=\"color: var(--shiki-color-text)\">(addr0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> addr3))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"138\"><span style=\"color: var(--shiki-token-comment)\">// approve the allowance for add3 to 20</span></li><li value=\"139\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">approve</span><span style=\"color: var(--shiki-color-text)\">(acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">20</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"140\"><span style=\"color: var(--shiki-token-comment)\">// assert that allowance is correct</span></li><li value=\"141\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.allowance</span><span style=\"color: var(--shiki-color-text)\">(addr0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> addr3))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">20</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"142\"><span style=\"color: var(--shiki-token-comment)\">// check the balances again -- they haven't changed</span></li><li value=\"143\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertBalances</span><span style=\"color: var(--shiki-color-text)\">(totalSupply </span><span style=\"color: var(--shiki-token-keyword)\">-</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"144\"></li><li value=\"145\"><span style=\"color: var(--shiki-token-comment)\">// transferFrom of more than an allowance should fail</span></li><li value=\"146\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertFail</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\">(acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">100</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">20</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"147\"></li><li value=\"148\"><span style=\"color: var(--shiki-token-comment)\">// transferFrom spender, from, to, 10</span></li><li value=\"149\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\">(acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"150\"><span style=\"color: var(--shiki-token-comment)\">// assert the allowance for addr3</span></li><li value=\"151\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.allowance</span><span style=\"color: var(--shiki-color-text)\">(addr0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> addr3))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"152\"><span style=\"color: var(--shiki-token-comment)\">// assertBalances updated after transfer</span></li><li value=\"153\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertBalances</span><span style=\"color: var(--shiki-color-text)\">(totalSupply </span><span style=\"color: var(--shiki-token-keyword)\">-</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">20</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"154\"><span style=\"color: var(--shiki-token-comment)\">// transfer the 10 from acc3 back to acc0</span></li><li value=\"155\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\">(acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"156\"><span style=\"color: var(--shiki-token-comment)\">// assert the allowance has changed</span></li><li value=\"157\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.allowance</span><span style=\"color: var(--shiki-color-text)\">(addr0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> addr3))[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"158\"><span style=\"color: var(--shiki-token-comment)\">// check the balances</span></li><li value=\"159\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertBalances</span><span style=\"color: var(--shiki-color-text)\">(totalSupply </span><span style=\"color: var(--shiki-token-keyword)\">-</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">30</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"160\"><span style=\"color: var(--shiki-token-comment)\">// transferFrom should use up the allowance</span></li><li value=\"161\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertFail</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-function)\">transferFrom</span><span style=\"color: var(--shiki-color-text)\">(acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc3</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">0</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"162\"></li><li value=\"163\"><span style=\"color: var(--shiki-token-comment)\">// Even if you're rich, you can't transfer more than your balance.</span></li><li value=\"164\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">assertFail</span><span style=\"color: var(--shiki-color-text)\">(</span><a href=\"/frontend/#js_transfer\" title=\"js: transfer\"><span style=\"color: var(--shiki-token-function)\">transfer</span></a><span style=\"color: var(--shiki-color-text)\">(acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc2</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> totalSupply </span><span style=\"color: var(--shiki-token-keyword)\">-</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">10</span><span style=\"color: var(--shiki-color-text)\">));</span></li><li value=\"165\"></li><li value=\"166\"><span style=\"color: var(--shiki-token-comment)\">// approve allowance of 100 tokens to acc0</span></li><li value=\"167\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-function)\">approve</span><span style=\"color: var(--shiki-color-text)\">(acc0</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> acc1</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">100</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"168\"></li><li value=\"169\"><span style=\"color: var(--shiki-token-comment)\">// assert the view values are as expected</span></li><li value=\"170\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.name</span><span style=\"color: var(--shiki-color-text)\">())[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">meta</span><span style=\"color: var(--shiki-color-text)\">.name</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"name()\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"171\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.symbol</span><span style=\"color: var(--shiki-color-text)\">())[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">meta</span><span style=\"color: var(--shiki-color-text)\">.symbol</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"symbol()\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"172\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.totalSupply</span><span style=\"color: var(--shiki-color-text)\">())[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">meta</span><span style=\"color: var(--shiki-color-text)\">.totalSupply</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"totalSupply()\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"173\"><span style=\"color: var(--shiki-token-function)\">assertEq</span><span style=\"color: var(--shiki-color-text)\">((</span><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\" title=\"js: await\"><span style=\"color: var(--shiki-token-keyword)\">await</span></a><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">ctc0</span><span style=\"color: var(--shiki-token-function)\">.</span><span style=\"color: var(--shiki-token-constant)\">v</span><span style=\"color: var(--shiki-token-function)\">.decimals</span><span style=\"color: var(--shiki-color-text)\">())[</span><span style=\"color: var(--shiki-token-constant)\">1</span><span style=\"color: var(--shiki-color-text)\">]</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-constant)\">meta</span><span style=\"color: var(--shiki-color-text)\">.decimals</span><span style=\"color: var(--shiki-token-punctuation)\">,</span><span style=\"color: var(--shiki-color-text)\"> </span><span style=\"color: var(--shiki-token-string-expression)\">\"decimals()\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li><li value=\"174\"></li><li value=\"175\"><span style=\"color: var(--shiki-token-constant)\">console</span><span style=\"color: var(--shiki-token-function)\">.log</span><span style=\"color: var(--shiki-color-text)\">(</span><span style=\"color: var(--shiki-token-string-expression)\">\"Finished testing!\"</span><span style=\"color: var(--shiki-color-text)\">);</span></li></ol></pre>\n<h2 id=\"running-the-erc20-test-suite\" class=\"refHeader\">Running the ERC20 Test Suite<a aria-hidden=\"true\" tabindex=\"-1\" href=\"#running-the-erc20-test-suite\"><span class=\"icon icon-link\"></span></a></h2>\n<p>\n  <i id=\"p_66\" class=\"pid\"></i>Now, we can run our application.\n  Remember, this is only designed to work on the Ethereum network, so we'll run with:<a href=\"#p_66\" class=\"pid\">66</a>\n</p>\n<pre class=\"snippet unnumbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"REACH_CONNECTOR_MODE=ETH ./reach run\" href=\"#\" id=\"copyBtn30\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\"><span style=\"color: var(--shiki-token-keyword)\">$</span><span style=\"color: var(--shiki-color-text)\"> REACH_CONNECTOR_MODE</span><span style=\"color: var(--shiki-token-keyword)\">=</span><span style=\"color: var(--shiki-color-text)\">ETH ./reach run</span></li></ol></pre>\n<p><i id=\"p_67\" class=\"pid\"></i>The output looks something like:<a href=\"#p_67\" class=\"pid\">67</a></p>\n<pre class=\"snippet numbered\"><div class=\"codeHeader\">&nbsp;<a class=\"far fa-copy copyBtn\" data-clipboard-text=\"Starting up...\nCompleted startMeUp\nfinised getting contract handles\nStarting tests...\nassertEvent complete\nassertEvent call complete\nassertBalances complete\nassertBalances call complete\nassertFail2 call complete\nassertEvent complete\ntransfer complete\ntransfer call complete\nassertEvent complete\nassertEvent complete\ntransferFrom complete is true\ntransferFrom call complete\nassertEvent complete\ntransfer complete\nassertBalances complete\nassertEvent complete\napprove complete\nassertBalances complete\nassertEvent complete\nassertEvent complete\ntransferFrom complete is true\nassertBalances complete\nassertEvent complete\nassertEvent complete\ntransferFrom complete is true\nassertBalances complete\nassertEvent complete\napprove complete\nFinished testing!\" href=\"#\" id=\"copyBtn31\" title=\"Copy to clipboard\"></a></div><ol class=\"snippet\"><li value=\"1\">Starting up...</li><li value=\"2\">Completed startMeUp</li><li value=\"3\">finised getting contract handles</li><li value=\"4\">Starting tests...</li><li value=\"5\">assertEvent complete</li><li value=\"6\">assertEvent call complete</li><li value=\"7\">assertBalances complete</li><li value=\"8\">assertBalances call complete</li><li value=\"9\">assertFail2 call complete</li><li value=\"10\">assertEvent complete</li><li value=\"11\">transfer complete</li><li value=\"12\">transfer call complete</li><li value=\"13\">assertEvent complete</li><li value=\"14\">assertEvent complete</li><li value=\"15\">transferFrom complete is true</li><li value=\"16\">transferFrom call complete</li><li value=\"17\">assertEvent complete</li><li value=\"18\">transfer complete</li><li value=\"19\">assertBalances complete</li><li value=\"20\">assertEvent complete</li><li value=\"21\">approve complete</li><li value=\"22\">assertBalances complete</li><li value=\"23\">assertEvent complete</li><li value=\"24\">assertEvent complete</li><li value=\"25\">transferFrom complete is true</li><li value=\"26\">assertBalances complete</li><li value=\"27\">assertEvent complete</li><li value=\"28\">assertEvent complete</li><li value=\"29\">transferFrom complete is true</li><li value=\"30\">assertBalances complete</li><li value=\"31\">assertEvent complete</li><li value=\"32\">approve complete</li><li value=\"33\">Finished testing!</li></ol></pre>\n<p><i id=\"p_68\" class=\"pid\"></i>Th-th-th-that's all, folks!<a href=\"#p_68\" class=\"pid\">68</a></p>\n<p>\n  <i id=\"p_69\" class=\"pid\"></i>Our test suite was 175 lines and our Reach application was 106 lines.\n  Great job!<a href=\"#p_69\" class=\"pid\">69</a>\n</p>","<ul><li class=\"dynamic\">\n    <a href=\"#erc20\">ERC20</a>\n    <ul class=\"dynamic\">\n      <li class=\"dynamic\"><a href=\"#the-erc20-standard\">The ERC20 Standard</a></li>\n      <li class=\"dynamic\"><a href=\"#the-erc20-standard-in-reach\">The ERC20 Standard in Reach</a></li>\n      <li class=\"dynamic\"><a href=\"#the-core-of-an-erc20-in-reach\">The Core of an ERC20 in Reach</a></li>\n      <li class=\"dynamic\"><a href=\"#an-erc20-testing-frontend\">An ERC20 Testing Frontend</a></li>\n      <li class=\"dynamic\"><a href=\"#the-erc20-apis-in-reach\">The ERC20 APIs in Reach</a></li>\n      <li class=\"dynamic\"><a href=\"#the-rest-of-the-erc20-test-suite\">The Rest of the ERC20 Test Suite</a></li>\n      <li class=\"dynamic\"><a href=\"#running-the-erc20-test-suite\">Running the ERC20 Test Suite</a></li>\n    </ul>\n  </li></ul>"]